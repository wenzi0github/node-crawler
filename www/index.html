<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>贴吧帖子解析</title>
	<link rel="stylesheet" type="text/css" href="./css/reset.css">
    <link rel="stylesheet" type="text/css" href="./css/style.css">
</head>
<body class="global_body">
	<div class="main">
		<div class="content">
			<h2>帖子分析</h2>
			<form action="" onSubmit="toCheck(); return false;">
				http://tieba.baidu.com/
				<input type="text" id="tnum" autofocus="true" autocomplete="off" value="2632390666"  >
                <input type="hidden" id="last"/>
				<input type="submit" id="submit" class="submit" value="确定">
			</form>
		</div>
		<div class="process">
			<div class="step"></div>
			<div class="list"></div>
		</div>
	</div>
	<div class="layer"></div>
	<div class="escope" id="escope">
    	<p class="url"></p>
    	<p class="title"></p>
    	<p class="name"></p>
    	<p class="page"></p>
    	<p class="es_btn">
    		<input type="button" class="btn" id="reset" value="重新设置">
    		<input type="button" class="btn" id="ok" value="确定">
    	</p>
    </div>
    
</body>
<script type="text/javascript" src="./js/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
$(function(){
    var socket = io.connect(null);
    Crawler.socket = socket;
    socket.on("connect", function () {
        Crawler.log('连接成功');
    })
    socket.on("system", function(data){
        Crawler.log(data.msg);
	});

	socket.on("subResult", function(data){
		Crawler.log(data.msg);
		$("#submit").removeAttr("disabled");
        if(data.result){
            $('.layer, .escope').show();
            var result = data.result;
            for(var key in result){
                $('.'+key).html(key+' : '+result[key]);
            }
        }
	});

    $("#ok").click(function(){
        socket.emit("content", {});
        $('.layer, .escope').hide();
    });
    $("#reset").click(function(){
        $("#tnum").focus();
        $("#last").val($("#tnum").val());
        $('.layer, .escope').hide();
    })
});

// onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')"
function toCheck(){
	var tnum = $("#tnum").val();
	if(tnum===""){
        Crawler.log("输入不能为空", "warning");
	}else{
		tnum = tnum.replace(/\D/g,'');
		if(tnum===""){
			Crawler.log("输入不合法，请重新输入", "warning");
		}else{
			$("#submit").attr("disabled", "disabled");
            Crawler.socket.emit("submit", tnum);
		}
	}
}

var Crawler = {
    socket : null,
	log : function(msg, type){
		type = type || "";
		$(".list").append('<p class="'+type+'">'+msg+'</p>');
		$('.process').scrollTop($(".list").height());
	}
}
</script>
</html>